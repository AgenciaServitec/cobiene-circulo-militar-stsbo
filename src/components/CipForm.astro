---
import "notyf/notyf.min.css";
---

<section class="flex items-center justify-center min-h-screen bg-blue-200">
  <form
    id="cip-form"
    class="bg-white p-10 rounded-3xl shadow-xl w-full max-w-md space-y-8 transform transition-all duration-300 hover:shadow-2xl"
  >
    <h2 class="text-3xl font-extrabold text-center text-gray-800">Verifica si eres Socio</h2>

    <div class="flex flex-col space-y-4">
      <label for="cip" class="text-lg font-medium text-gray-800">Ingrese su CIP</label>
      <input
        type="text"
        id="cip"
        name="cip"
        maxlength="9"
        minlength="9"
        required
        class="px-6 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-300"
      />
    </div>

    <button
      id="button"
      type="submit"
      class="w-full py-3 px-6 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 transition-all duration-300 transform hover:scale-105"
    >
      Verificar
    </button>
  </form>
</section>

<script>
  import { Notyf } from "notyf";
  import apiResponse from "../data-list/api-response.json";

  const notyf = new Notyf();
  const button = document.getElementById("button");

  document.getElementById("cip-form").addEventListener("submit", async (e) => {
    e.preventDefault();

    const cip = document.getElementById("cip");

    button.disabled = true;
    button.textContent = "Cargando...";
    button.classList.add("opacity-60", "cursor-not-allowed");

    try {
      const response = await fetch(`https://api-korekenke-dev.web.app/consult/cmsts/${cip.value}`);
      const message = await response.text();

      if (response.ok) {
        notyf.success(apiResponse[message]);
      } else {
        notyf.error(apiResponse[message]);
      }
    } catch (error) {
      notyf.error("Error al conectar con el servidor.");
      console.error(error);
    } finally {
      button.disabled = false;
      button.textContent = "Verificar";
      button.classList.remove("opacity-60", "cursor-not-allowed");
      cip.value = "";
    }
  });
</script>
